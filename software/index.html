<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Rafael de Oliveira Calcada">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Compiling software for Steel - Steel Core Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Compiling software for Steel";
    var mkdocs_page_input_path = "software.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Steel Core Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../getting/">Getting started</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../steelio/">I/O signals</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../timing/">Timing diagrams</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Compiling software for Steel</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../examplesoc/">Example system</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../traps/">Exceptions and interrupts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../uarch/">Microarchitecture</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../details/">Implementation details</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Steel Core Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Compiling software for Steel</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/rafaelcalcada/steel-core/edit/master/docs/software.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="compiling-software-for-steel">Compiling software for Steel</h1>
<p>The <a href="https://github.com/riscv/riscv-gnu-toolchain">RISC-V GNU Toolchain</a> provides the Newlib cross-compiler, which can be used to compile software for Steel. To configure the compiler for Steel and install it follow these steps:</p>
<p><strong>1 - Clone the toolchain repo and all its submodules:</strong></p>
<pre><code>$ git clone --recursive https://github.com/riscv/riscv-gnu-toolchain
</code></pre>

<p><strong>2 - Install the prerequisites, according to your OS:</strong></p>
<p>On Ubuntu:</p>
<pre><code>$ sudo apt-get install autoconf automake autotools-dev curl python3 libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev
</code></pre>

<p>On Fedora/CentOS/RHEL OS:</p>
<pre><code>$ sudo yum install autoconf automake python3 libmpc-devel mpfr-devel gmp-devel gawk  bison flex texinfo patchutils gcc gcc-c++ zlib-devel expat-devel
</code></pre>

<p>On Arch Linux:</p>
<pre><code>$ pacman -Syyu autoconf automake curl python3 mpc mpfr gmp gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib expat
</code></pre>

<p>On OS X:</p>
<pre><code>$ brew install python3 gawk gnu-sed gmp mpfr libmpc isl zlib expat
</code></pre>

<p><strong>3 - Configure the installation for Steel (the toolchain will be installed in the path /opt/riscv):</strong></p>
<pre><code>$ cd riscv-gnu-toolchain
$ ./configure --prefix=/opt/riscv --with-arch=rv32i --with-abi=ilp32
</code></pre>

<p><strong>4 - Make the compiler:</strong></p>
<pre><code>$ make
</code></pre>

<h2>Compiling your program</h2>

<p>A program can be compiled to run on Steel with the following command (assuming you have installed the toolchain in the path <code>/opt/riscv</code>):</p>
<pre><code>$ cd /opt/riscv/bin
$ riscv32-unknown-elf-gcc --with-arch=rv32i --with-abi=ilp32 myprogram.c -o myprogram
</code></pre>

<p>The compiler will output an ELF file named <strong>myprogram</strong>. The flags <code>--with-arch=rv32i</code> and <code>--with-abi=ilp32</code> are optional if you have configured the compiler following the instructions in the section above.</p>
<p>To relocate the code to start at a specific address you can use the flag <code>-Ttext</code>. For example:</p>
<pre><code>$ cd /opt/riscv/bin
$ riscv32-unknown-elf-gcc --with-arch=rv32i --with-abi=ilp32 -Ttext 0x00000000 myprogram.c -o myprogram
</code></pre>

<blockquote>
<p><strong>Tip:</strong> If you are using an FPGA and your system's RAM is an array of memory, you may need to transform your program (which is an ELF file) into an .hex file. By doing this, you can use the .hex file with Verilog's <strong>$readmemh</strong> function to fill the memory array. To generate an .hex file from your compiled program, execute the following commands:</p>
</blockquote>
<pre><code>$ cd /opt/riscv/bin
$ riscv32-unknown-elf-objcopy -O binary myprogram myprogram.bin
$ od -t x4 -v -An -w1 myprogram.bin &gt; myprogram.dump
$ cut -c2- myprogram.dump &gt; myprogram.hex
$ rm myprogram.bin myprogram.dump
</code></pre>

<blockquote>
<p>The <strong>util</strong> directory has a script called <strong>elf2hex</strong> that transforms an ELF into an .hex file. See the contents of the file <strong>soc/ram.v</strong> to learn how to build a RAM memory using Verilog arrays.</p>
</blockquote>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../examplesoc/" class="btn btn-neutral float-right" title="Example system">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../timing/" class="btn btn-neutral" title="Timing diagrams"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/rafaelcalcada/steel-core/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../timing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../examplesoc/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../extra.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
